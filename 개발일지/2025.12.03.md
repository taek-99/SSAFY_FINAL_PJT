# 개발 일지

## 전날 완료 사항
- 의료인 인증을 위한 간편인증 시스템 완료
- 네이버 지도 검색 기능 추가
- 모바일 반응형 처리 완료
- 의료진일 때만 main화면에서 외료기능 사용 가능
    - 일반인 모드일땐 의료진 전용 버튼 아예 안나오게

## Today 진행 예정 (2.5hr)
- 리팩토링 점검
- 환자 증상 입력 후 벡엔드 통신
- 설명서 제작

## 학습 내용
-  환자 증상 입력 하는 법 마네킹 불러와서 부위 선택후 증상 입력 방식
1. 마네킹 불러오는 법
    - Three.js 사용
    - sketchfab 사이트에서 glTF 파일 불러옴
    - 이론상 코드 구현법
        - 씬 불러옴
        - 카메라 불러옴
        - 조명 생성
        - 배경 생성
        - glTF 파일 불러옴
        - 렌더링 진행

2. 마네킹 마우스로 카메라 위치 변경 및 줌인& 줌아웃
    - mousedown, mousemove, wheel, click
    - 각 이벤트들 등록후 position 설정 => 말은 쉽다.
    
3. 부위별 선택
-  glTF 메쉬 분리 작업 (Blender)
    - 원본 glTF가 하나의 Mesh로 붙어 있어서,
    - Blender에서 Head, Chest, UpperBack, LowerBack, Abdomen, Biceps_L/R, Forearm_L/R, Hand_L/R, Thighs_L/R, Calf_L/R, Foot_L/R, Hips, Genitalia 이런 식으로 오브젝트 단위로 전부 잘라서 분리했고
    - 다시 glTF + bin 파일로 Export 해서 프로젝트에 교체함.
    - Three.js 쪽에서 새 glTF 구조에 맞게 코드 수정
    - GLTFLoader로 새 scene.gltf 불러오고,
    - model.getObjectByName("Head") 이런 식으로 각 body part를 이름으로 찾아서 parts[name]에 저장하는 로직 추가.

- 부위별 Hitbox 생성 & 위치 고정
    - bodyParts 배열 만들어서
    - name (GLTF 노드 이름)
    - type (sphere / box)
    - pos (월드 기준 위치) / 혹은 파트 하위로 붙이기
    - size (구면 radius, 박스 w/h/d)
    - makeHitbox()에서
    - SphereGeometry + BoxGeometry로 히트박스(반투명 wireframe) 생성
    - 각 부위마다 hitbox 만들어서 hitboxes[name]에 저장
    - model.add(mesh) 혹은 parts[name].add(mesh)로 해당 부위 위치에 고정.

- Raycaster로 부위 클릭 & 토글 스위치 구현
    - raycaster + mouse 사용해서
    - renderer.domElement 클릭 좌표 → NDC(-1 ~ 1) 변환
    - raycaster.intersectObjects(Object.values(hitboxes), false) 로 어떤 hitbox가 맞았는지 판별.
    - 맞은 hitbox의 name으로 togglePart(name) 호출해서

- selected[name] 토글
    - 해당 part의 메쉬 material clone 후
    - 선택 시: 빨간색
    - 해제 시: 기본 흰색으로 복귀

- Vue 쪽 symptom 상태 관리 + 입력폼 연동
    - symptoms에 선택된 부위 name 목록 관리
    - bodyPartLabels를 따로 만들어서 { name: "Head", label: "머리" } 이런 매핑 추가
    - SymptomDescription을 ref({})로 두고 v-model="SymptomDescription[value.label]" 으로 부위별 상세 증상 텍스트 입력 받도록 구현
    - v-for로 bodyPartLabels.filter(v => symptoms.includes(v.name)) 돌려서 현재 선택된 부위만 표시 + 우측에 텍스트 input 정렬 (flex + justify-between)

- 백엔드 전송 형태 설계
    - SymptomDescription.value를 기반으로
    - { "머리": "두통 심함", "손": "통증 없음" } 형태 그대로 보내거나
    - ["머리: 두통 심함", "손: 통증 없음"] 형태로 합쳐서 보내는 패턴까지 설계
    - axios.post(${API_BASE_URL}hospitals/user/location/, { symptoms: ... }) 구조까지 맞춰봄


## 실패한것 + 이유 or 부족한 부분
- 첨에 증상 입력 부분을 별생각 없었다가 마네킹 불러와서 부위 선택하기로 결정 하면서 시간 지연

## 내일 할거
- 병원 리스트 받은 다음 화면 구성
- 오늘 작업한 코드 리뷰 후 구조 보완